import{produceRandomNumbers as t}from"../fortunes.js";import{convertArrToReadableString as o,state as n}from"../ticket.js";import{chooseOptionFromArr as r}from"../util.js";import{saveState as s}from"../storage.js";import{updateticketHistoryCount as u}from"./ticketHistory.js";const c=1,i=0,a=.3,l="assets/images/image-bank-front/header-";let d={},m,y,v,p,f,k,g=!1,e=!0,h=!1;function b(){return h}function w(){d.storeTicketPrompt.style.display="inline"}function L(){d.storeTicketPrompt.style.display="none",g=!1,h=!1}function S(e){e?(y&&y.play(),d.body.classList.add("shake"),n.currentImageBack=r(f),n.currentImageFront=r(p),n.currentMessage=r(v.fortunes).message,n.currentNumbers=t(4,1,100),d.ticketImage.src=""+l+n.currentImageFront+".png",d.fortuneOutput.textContent=n.currentMessage,d.fortuneNumber.textContent=`Your lucky numbers are: 
		`+o(n.currentNumbers),g=!0,setTimeout(()=>{d.ticket.classList.add("visible")},1300),h=!0):h&&(w(),d.body.classList.remove("shake"),d.ticket.classList.remove("visible"),w())}function E(){k=!k,localStorage.setItem("MuteAudio",k),m.volume=k?0:a,y.volume=k?0:a,d.volumeOn.style.display=k?"none":"inline",d.volumeOff.style.display=k?"inline":"none"}function q(){g?S(i):S(c)}function j(e){e.forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),e=t.id,L(),"saveTicket"===e&&s(n,"2d")&&u(),L(),h=!1})})}function O(){(m=new Audio("assets/audio/background.wav")).loop=!0,m.muted=!0,m.volume=k?0:a,(y=new Audio("assets/audio/thunder2d.wav")).volume=k?0:a,async function(){fetch("assets/json/responses.json").then(e=>e.json()).then(e=>{v=e})}(),async function(){fetch("assets/json/images.json").then(e=>e.json()).then(e=>{p=e.front,f=e.back})}(),m.play(),d.splash.classList.add("hidden"),window.removeEventListener("mousedown",O),window.removeEventListener("keydown",O),d.volumeOn.style.display="inline";let e=0;const t=a/50,o=setInterval(()=>{e+=100,m.volume=Math.min(a,t*(e/1e3)),5e3<=e&&(clearInterval(o),m.play())},100)}function T(){window.location="https://cse110-sp23-group23.github.io/cse110-sp23-group23/source/8ball/"}document.addEventListener("keydown",e=>{"Escape"===e.key?S(i):" "===e.key&&(g?S(i):S(c))}),document.addEventListener("DOMContentLoaded",function(){d={body:document.querySelector("body"),fortuneOutput:document.querySelector("#fortune-output"),ticket:document.querySelector("#mainTicket"),zoltar:document.querySelector("#eightBallContainer"),ticketX:document.getElementById("closeTicket"),fortuneNumber:document.querySelector("#fortune-number"),volumeControl:document.querySelector(".volume-controls"),volumeOn:document.querySelector("#volumeOn"),volumeOff:document.querySelector("#volumeOff"),splash:document.querySelector("#splash-screen"),loadedMessage:document.querySelector(".loaded-message"),storeTicketPrompt:document.querySelector("#storeTicketPrompt"),storeButton:document.querySelectorAll(".storeButton"),ticketImage:document.querySelector(".ticket-header-image"),eightball:document.querySelector("#eight-ball-image")},window.addEventListener("mousedown",O),window.addEventListener("keydown",O),d.eightball.addEventListener("click",T),d.volumeControl.addEventListener("click",E),d.zoltar.addEventListener("click",q),d.ticketX.addEventListener("click",()=>{S(i)}),j(d.storeButton),setTimeout(()=>{d.loadedMessage.innerText="[ press anywhere to continue ]"},500)}),document.addEventListener("click",()=>{e&&(m.play(),m.muted=!1,e=!1)});export{b as isTicketOnScreen,T as openEightBall};